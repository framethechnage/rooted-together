<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrametheChnage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap');
        
        :root {
            --forest-vibrant: #2d5a27;
            --sunlight: #fdfbf0;
            --moss-light: #a3b18a;
            --leaf-bright: #588157;
        }

        body, html { 
            font-family: 'Caveat', cursive; 
            background-color: #f4f7f2;
            color: #1b261b;
            margin: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .bg-textured {
            position: fixed;
            inset: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(88, 129, 87, 0.1) 0%, transparent 40%),
                url("https://www.transparenttextures.com/patterns/asfalt-light.png");
            z-index: -1;
        }

        .sun-ray {
            position: fixed;
            top: -100px;
            left: 20%;
            width: 300px;
            height: 1000px;
            background: linear-gradient(to bottom, rgba(253, 251, 240, 0.4) 0%, transparent 100%);
            transform: rotate(-35deg);
            pointer-events: none;
            z-index: 0;
            filter: blur(60px);
        }

        .leaf-particle {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            color: rgba(88, 129, 87, 0.4);
            animation: drift linear infinite;
        }

        @keyframes drift {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(110vh) translateX(80px) rotate(360deg); opacity: 0; }
        }

        .glass-notepad {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 3rem;
        }

        .note-paper {
            background-image: linear-gradient(rgba(88, 129, 87, 0.05) 1px, transparent 1px);
            background-size: 100% 2.8rem;
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            color: #2d4a2d;
            transition: all 0.4s;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .language-gate {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #fdfbf0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease;
        }

        .lang-card {
            background: white;
            padding: 40px;
            border-radius: 40px;
            text-align: center;
            max-width: 600px;
            width: 90%;
        }

        .lang-btn {
            padding: 12px;
            background: white;
            border: 1px solid rgba(88, 129, 87, 0.2);
            border-radius: 20px;
            font-size: 1.4rem;
            width: 100%;
            margin: 5px 0;
            transition: background 0.3s;
        }

        .lang-btn:hover {
            background: #f0f4f0;
        }

        .top-branding {
            text-align: center;
            padding: 30px 0;
            letter-spacing: 0.3em;
            font-size: 1.4rem;
            color: var(--forest-vibrant);
            font-weight: 700;
        }
    </style>
</head>
<body>

    <div class="bg-textured"></div>
    <div class="sun-ray"></div>
    <div id="leaf-container"></div>

    <div id="languageGate" class="language-gate">
        <div class="lang-card">
            <h2 class="text-4xl mb-8 text-emerald-900">What language are you most comfortable with?</h2>
            <div id="langGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="pickLanguage('English')" class="lang-btn">English</button>
                <button onclick="pickLanguage('Hindi')" class="lang-btn">हिन्दी</button>
                <button onclick="pickLanguage('Spanish')" class="lang-btn">Español</button>
                <button onclick="pickLanguage('Bengali')" class="lang-btn">বাংলা</button>
                <button onclick="pickLanguage('French')" class="lang-btn">Français</button>
                <button onclick="pickLanguage('Japanese')" class="lang-btn">日本語</button>
            </div>
            <div id="gateLoader" class="hidden mt-8 text-emerald-700 italic text-2xl animate-pulse">
                Setting the space for you...
            </div>
        </div>
    </div>

    <main id="mainApp" class="opacity-0 transition-opacity duration-1000 hidden">
        <header class="top-branding">FrametheChnage</header>

        <section class="pt-6 pb-12 px-6 text-center">
            <div id="quoteBox" class="p-6 max-w-2xl mx-auto italic mb-8 text-3xl md:text-5xl text-emerald-950 leading-relaxed">
                "Leave a note bearing soemthing you wish someone had told you. Or simply just be present till you feel better"
            </div>
            <h1 id="heroTitle" class="text-6xl md:text-8xl text-emerald-900 mb-4">rOOTed tOgEThER</h1>
            <p id="heroSubtitle" class="text-2xl text-emerald-800/60">here for all.</p>
        </section>

        <section class="py-12 px-6 max-w-4xl mx-auto">
            <div class="mb-6 flex justify-between items-end">
                <p id="dateStamp" class="text-emerald-700/40 text-lg font-bold">LOADING...</p>
                <button id="saveBtn" onclick="saveNote()" class="p-4 glass-btn rounded-2xl flex items-center gap-2">
                    <i class="fa-solid fa-seedling text-emerald-600"></i> <span id="saveBtnText">Preserve</span>
                </button>
            </div>

            <div class="glass-notepad">
                <div class="note-paper p-8 md:p-12 min-h-[350px]">
                    <textarea id="noteInput" class="w-full bg-transparent border-none focus:ring-0 text-3xl text-emerald-950 placeholder:text-emerald-900/10 resize-none h-64 outline-none" placeholder="Let your thoughts settle on the page..."></textarea>
                </div>
            </div>
        </section>

        <section id="notesFeed" class="py-20 px-6 max-w-6xl mx-auto grid md:grid-cols-2 gap-10"></section>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'rooted-shared-live';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const apiKey = "";

        let user = null;

        window.pickLanguage = async (lang) => {
            document.getElementById('langGrid').classList.add('hidden');
            document.getElementById('gateLoader').classList.remove('hidden');

            // Start translation process in parallel, but don't block the UI transition entirely
            const translatePromise = (async () => {
                if (lang === "English") return null;
                try {
                    const ui = {
                        quote: "Leave a note bearing soemthing you wish someone had told you. Or simply just be present till you feel better",
                        subtitle: "here for all.",
                        placeholder: "Let your thoughts settle on the page...",
                        preserve: "Preserve"
                    };
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Translate these values to ${lang}. Keep "rOOTed tOgEThER" and "FrametheChnage" as is. JSON: ${JSON.stringify(ui)}` }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    return JSON.parse(data.candidates[0].content.parts[0].text);
                } catch (e) { 
                    console.error("Translation failed", e);
                    return null; 
                }
            })();

            // Transition UI
            const trans = await translatePromise;
            if (trans) {
                document.getElementById('quoteBox').innerText = `"${trans.quote}"`;
                document.getElementById('heroSubtitle').innerText = trans.subtitle;
                document.getElementById('noteInput').placeholder = trans.placeholder;
                document.getElementById('saveBtnText').innerText = trans.preserve;
            }

            document.getElementById('languageGate').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('languageGate').classList.add('hidden');
                const main = document.getElementById('mainApp');
                main.classList.remove('hidden');
                setTimeout(() => main.classList.remove('opacity-0'), 50);
                startEnv();
            }, 800);
        };

        window.saveNote = async () => {
            const text = document.getElementById('noteInput').value.trim();
            if (!text || !user) return;
            
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            btn.style.opacity = "0.5";

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'notes'), {
                    text,
                    uid: user.uid,
                    rot: (Math.random() * 4 - 2).toFixed(2),
                    ts: serverTimestamp()
                });
                document.getElementById('noteInput').value = "";
            } catch (e) { 
                console.error("Save failed", e); 
            } finally {
                btn.disabled = false;
                btn.style.opacity = "1";
            }
        };

        function startEnv() {
            document.getElementById('dateStamp').innerText = new Date().toLocaleDateString(undefined, { month: 'long', day: 'numeric' }).toUpperCase();
            setInterval(() => {
                const leaf = document.createElement('i');
                leaf.className = 'fa-solid fa-leaf leaf-particle';
                leaf.style.left = Math.random() * 100 + 'vw';
                leaf.style.animationDuration = (Math.random() * 8 + 8) + 's';
                document.getElementById('leaf-container').appendChild(leaf);
                setTimeout(() => leaf.remove(), 16000);
            }, 4000);
        }

        onAuthStateChanged(auth, (u) => {
            user = u;
            if (user) {
                const notesCollection = collection(db, 'artifacts', appId, 'public', 'data', 'notes');
                onSnapshot(notesCollection, (snap) => {
                    const list = [];
                    snap.forEach(d => list.push(d.data()));
                    list.sort((a,b) => (b.ts?.seconds || 0) - (a.ts?.seconds || 0));
                    document.getElementById('notesFeed').innerHTML = list.map(n => `
                        <div class="glass-notepad p-10 shadow-sm" style="transform: rotate(${n.rot}deg)">
                            <div class="text-3xl text-emerald-950 whitespace-pre-wrap">${n.text}</div>
                        </div>
                    `).join('');
                }, (error) => {
                    console.error("Firestore sync error:", error);
                });
            }
        });

        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                console.error("Auth init failed", e);
            }
        };
        initAuth();
    </script>
</body>
</html>
