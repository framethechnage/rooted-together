<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FrametheChnage | Personal Sanctuary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&display=swap');
        
        :root {
            --forest-vibrant: #2d5a27;
            --sunlight: #fdfbf0;
            --moss-light: #a3b18a;
            --leaf-bright: #588157;
        }

        body, html { 
            font-family: 'Caveat', cursive; 
            background-color: #f4f7f2;
            color: #1b261b;
            margin: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .bg-textured {
            position: fixed;
            inset: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(88, 129, 87, 0.1) 0%, transparent 40%),
                url("https://www.transparenttextures.com/patterns/asfalt-light.png");
            z-index: -1;
        }

        .sun-ray {
            position: fixed;
            top: -100px;
            left: 20%;
            width: 300px;
            height: 1000px;
            background: linear-gradient(to bottom, rgba(253, 251, 240, 0.4) 0%, transparent 100%);
            transform: rotate(-35deg);
            pointer-events: none;
            z-index: 0;
            filter: blur(60px);
        }

        .leaf-particle {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            color: rgba(88, 129, 87, 0.4);
            animation: drift linear infinite;
        }

        @keyframes drift {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(110vh) translateX(80px) rotate(360deg); opacity: 0; }
        }

        .glass-notepad {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 3rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
        }

        .note-paper {
            background-image: linear-gradient(rgba(88, 129, 87, 0.05) 1px, transparent 1px);
            background-size: 100% 2.8rem;
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            color: #2d4a2d;
            transition: all 0.4s;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .language-gate {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #fdfbf0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease;
        }

        .lang-card {
            background: white;
            padding: 40px;
            border-radius: 40px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.05);
        }

        .lang-btn {
            padding: 12px;
            background: #fcfdfc;
            border: 1px solid rgba(88, 129, 87, 0.1);
            border-radius: 20px;
            font-size: 1.4rem;
            width: 100%;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            background: #f0f4f0;
            border-color: var(--leaf-bright);
        }

        .top-branding {
            text-align: center;
            padding: 30px 0;
            letter-spacing: 0.3em;
            font-size: 1.4rem;
            color: var(--forest-vibrant);
            font-weight: 700;
        }

        #mainApp {
            display: none;
            opacity: 0;
            transition: opacity 1.2s ease;
        }

        .fade-in {
            animation: fadeIn 1s forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #error-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #991b1b;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            display: none;
            z-index: 2000;
        }
    </style>
</head>
<body>

    <div class="bg-textured"></div>
    <div class="sun-ray"></div>
    <div id="leaf-container"></div>
    <div id="error-toast">Something went wrong. Please try again.</div>

    <div id="languageGate" class="language-gate">
        <div class="lang-card">
            <h2 class="text-4xl mb-8 text-emerald-900">What language are you most comfortable with?</h2>
            <div id="langGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button class="lang-btn" onclick="handleLangSelection('English')">English</button>
                <button class="lang-btn" onclick="handleLangSelection('Hindi')">हिन्दी</button>
                <button class="lang-btn" onclick="handleLangSelection('Spanish')">Español</button>
                <button class="lang-btn" onclick="handleLangSelection('Bengali')">বাংলা</button>
                <button class="lang-btn" onclick="handleLangSelection('French')">Français</button>
                <button class="lang-btn" onclick="handleLangSelection('Japanese')">日本語</button>
            </div>
            <div id="gateLoader" class="hidden mt-8 text-emerald-700 italic text-2xl animate-pulse">
                Setting the space for you...
            </div>
        </div>
    </div>

    <main id="mainApp">
        <header class="top-branding">FrametheChnage</header>

        <section class="pt-6 pb-12 px-6 text-center">
            <div id="quoteBox" class="p-6 max-w-2xl mx-auto italic mb-8 text-3xl md:text-5xl text-emerald-950 leading-relaxed">
                "Leave a note bearing something you wish someone had told you. Or simply just be present till you feel better"
            </div>
            <h1 id="heroTitle" class="text-6xl md:text-8xl text-emerald-900 mb-4">rOOTed tOgEThER</h1>
            <p id="heroSubtitle" class="text-2xl text-emerald-800/60">here for all.</p>
        </section>

        <section class="py-12 px-6 max-w-4xl mx-auto">
            <div class="mb-6 flex justify-between items-end">
                <p id="dateStamp" class="text-emerald-700/40 text-lg font-bold">LOADING...</p>
                <button id="saveBtn" onclick="savePersonalNote()" class="p-4 glass-btn rounded-2xl flex items-center gap-2">
                    <i class="fa-solid fa-seedling text-emerald-600"></i> <span id="saveBtnText">Preserve</span>
                </button>
            </div>

            <div class="glass-notepad">
                <div class="note-paper p-8 md:p-12 min-h-[400px]">
                    <textarea id="noteInput" class="w-full bg-transparent border-none focus:ring-0 text-3xl text-emerald-950 placeholder:text-emerald-900/10 resize-none h-80 outline-none" placeholder="Let your thoughts settle on the page..."></textarea>
                </div>
            </div>
        </section>

        <section id="personalFeed" class="py-20 px-6 max-w-6xl mx-auto grid md:grid-cols-2 gap-10"></section>
    </main>

    <script>
        const apiKey = ""; 
        let currentLanguage = "English";
        
        let globalWisdom = [
            { text: "do what you're supposed to do, so you can do what you want to.", date: "Found in the wind", id: "g1", rotation: -1.5 },
            { text: "you're you and noone else is. don't lose that advantage.", date: "Written in the bark", id: "g2", rotation: 1.2 },
            { text: "girl chill out you got this trust", date: "Whispered by leaves", id: "g3", rotation: -0.8 },
            { text: "you're lost? so are we! blind leading the blind core", date: "Carved in stone", id: "g4", rotation: 2.1 },
            { text: "there are always options and if not then create some bro", date: "Seen in the stars", id: "g5", rotation: -2.3 }
        ];

        async function apiFetchWithRetry(url, options, retries = 5, backoff = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error('API Error');
                return await response.json();
            } catch (err) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, backoff));
                    return apiFetchWithRetry(url, options, retries - 1, backoff * 2);
                }
                throw err;
            }
        }

        window.handleLangSelection = (lang) => {
            currentLanguage = lang;
            const gate = document.getElementById('languageGate');
            const grid = document.getElementById('langGrid');
            const loader = document.getElementById('gateLoader');
            
            grid.classList.add('hidden');
            loader.classList.remove('hidden');

            if (lang !== "English") {
                translateEverything(lang);
            } else {
                proceedToApp();
            }
        };

        function showError() {
            const toast = document.getElementById('error-toast');
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 5000);
            document.getElementById('langGrid').classList.remove('hidden');
            document.getElementById('gateLoader').classList.add('hidden');
        }

        function proceedToApp() {
            const gate = document.getElementById('languageGate');
            const main = document.getElementById('mainApp');
            gate.style.opacity = '0';
            setTimeout(() => {
                gate.style.display = 'none';
                main.style.display = 'block';
                main.offsetHeight; 
                main.style.opacity = '1';
                initSanctuary();
            }, 800);
        }

        async function translateEverything(lang) {
            try {
                const ui = {
                    quote: "Leave a note bearing something you wish someone had told you. Or simply just be present till you feel better",
                    subtitle: "here for all.",
                    placeholder: "Let your thoughts settle on the page...",
                    preserve: "Preserve",
                    wisdomNotes: globalWisdom.map(n => n.text),
                    wisdomDates: globalWisdom.map(n => n.date)
                };
                
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const result = await apiFetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Translate the following JSON object into ${lang}. Keep the tone poetic, artistic, and warm. Maintain the JSON structure exactly. Do NOT translate brand names "rOOTed tOgEThER" or "FrametheChnage". JSON: ${JSON.stringify(ui)}` }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                
                if (result.candidates && result.candidates[0].content.parts[0].text) {
                    const trans = JSON.parse(result.candidates[0].content.parts[0].text);
                    
                    document.getElementById('quoteBox').innerText = `"${trans.quote}"`;
                    document.getElementById('heroSubtitle').innerText = trans.subtitle;
                    document.getElementById('noteInput').placeholder = trans.placeholder;
                    document.getElementById('saveBtnText').innerText = trans.preserve;

                    globalWisdom = globalWisdom.map((n, i) => ({
                        ...n,
                        text: trans.wisdomNotes[i] || n.text,
                        date: trans.wisdomDates[i] || n.date
                    }));
                    
                    proceedToApp();
                } else {
                    throw new Error('Invalid response');
                }
            } catch (e) { 
                console.error(e);
                proceedToApp(); // Proceed anyway with English if translation fails
            }
        }

        function initSanctuary() {
            updateDate();
            renderPersonalNotes();
            startLeafStorm();
        }

        function updateDate() {
            document.getElementById('dateStamp').innerText = new Date().toLocaleDateString(undefined, { 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            }).toUpperCase();
        }

        window.savePersonalNote = () => {
            const input = document.getElementById('noteInput');
            const text = input.value.trim();
            if (!text) return;

            const notes = JSON.parse(localStorage.getItem('sanctuary_notes') || '[]');
            notes.unshift({
                text,
                date: new Date().toISOString(),
                id: Date.now(),
                rotation: (Math.random() * 4 - 2).toFixed(2),
                isUserGenerated: true
            });

            localStorage.setItem('sanctuary_notes', JSON.stringify(notes));
            input.value = "";
            renderPersonalNotes();
        };

        function renderPersonalNotes() {
            const savedNotes = JSON.parse(localStorage.getItem('sanctuary_notes') || '[]');
            // Always show globalWisdom, combined with savedNotes
            const allNotes = [...globalWisdom, ...savedNotes];
            const feed = document.getElementById('personalFeed');
            
            feed.innerHTML = allNotes.map(n => `
                <div class="glass-notepad p-10 fade-in shadow-sm relative group" style="transform: rotate(${n.rotation}deg)">
                    ${n.isUserGenerated ? `
                        <button onclick="deleteNote(${n.id})" class="absolute top-4 right-4 opacity-0 group-hover:opacity-40 transition-opacity hover:!opacity-100 text-emerald-900">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    ` : ''}
                    <div class="text-3xl text-emerald-950 whitespace-pre-wrap leading-relaxed">${n.text}</div>
                    <div class="mt-6 text-sm text-emerald-800/30 font-bold tracking-widest uppercase">
                        ${n.isUserGenerated ? new Date(n.date).toLocaleDateString() : n.date}
                    </div>
                </div>
            `).join('');
        }

        window.deleteNote = (id) => {
            let notes = JSON.parse(localStorage.getItem('sanctuary_notes') || '[]');
            notes = notes.filter(n => n.id !== id);
            localStorage.setItem('sanctuary_notes', JSON.stringify(notes));
            renderPersonalNotes();
        };

        function startLeafStorm() {
            const container = document.getElementById('leaf-container');
            setInterval(() => {
                const leaf = document.createElement('i');
                leaf.className = 'fa-solid fa-leaf leaf-particle';
                leaf.style.left = Math.random() * 100 + 'vw';
                leaf.style.fontSize = (Math.random() * 1 + 1) + 'rem';
                leaf.style.animationDuration = (Math.random() * 8 + 8) + 's';
                container.appendChild(leaf);
                setTimeout(() => leaf.remove(), 16000);
            }, 3500);
        }
    </script>
</body>
</html>
